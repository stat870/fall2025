---
title: "Assignment 5"
author: "Your Name"
date: "2025-10-15"
output: 
  pdf_document:
    extra_dependencies: ["float"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.pos = "H", out.extra = "", echo = TRUE)
```

## Goal of this assignment  

The goals of this assignment are to: 

- Review treatment structure and design structure of designed experiments. 
- Review analysis of data generated by a designed experiment using statistical software. 
- Review/refresh inference from said models. 

Please complete exercise (1), rename the `Rmd` file to "Assignment5_YourLastName.Rmd" (e.g., "Assignment5_Smith.Rmd"), your name in the header, and knit the Rmd to an html file or pdf file. Please submit that html or pdf file on CANVAS by Wednesday, OCtober 24th by midnight. You may work in pairs, but each one of you will have to submit your own file. 

**Formatting**: Please make sure that your knitted pdf or html document does not include unnecessary warnings/messages.  
For the statistical models, you can use \LaTeX code embedded in your Rmd, or paste a picture. You can check the raw Rmd files from the lectures (including \LaTeX code) at [https://github.com/stat870/fall2025/tree/main/_notes](https://github.com/stat870/fall2025/tree/main/_notes). Otherwise, you can check out the [Rmd cheatsheet](https://rstudio.github.io/cheatsheets/html/rmarkdown.html) or the `knitr::include_graphics()` function. 

## 1. 

Load the data below and answer the following questions. 

The data below come from an experiment studying different sanitizer treatments on the survival of bacteria on different surfaces. There are 8 different sanitizer treatments applied for 4 different times (e.g., leave the sanitizer it for 1 minute or for 5 minutes), and on 5 different surfaces. 
At the end of the study, the researchers count how many colony forming units (good sources of bacteria growth) they find. 
They wish to study whether the treatments had a different effect on the number of CFUs. 

```{r}
library(tidyverse)

url <- "https://raw.githubusercontent.com/stat870/fall2025/refs/heads/main/data/sanitizers.csv"
d <- read.csv(url)

d %>% 
  ggplot(aes(Treatment, Log.CFU.coupon))+
  geom_point()
```


```{r}
library(lme4)
m <- lmer(Log.CFU.coupon ~  factor(Treatment) * factor(Material) * Time + (1|Treatment:Time:Material:Biological.Rep),
          data = d)

library(mgcv)
m <- gam(list(Log.CFU.coupon ~  factor(Treatment) * factor(Material) * Time ,  
              ~ factor(Treatment):factor(Material)),
          family = gaulss(),
          data = d)
plot(m)

plot(predict(m)[,2], resid(m))

ggplot(data.frame(resid = resid(m)), aes(resid)) +
    stat_qq() +
    stat_qq_line() +
    theme_classic() +
    ggtitle(paste("Q-Q Plot of the residuals:", response))
 
qqnorm( resid(m))
qqline( resid(m))

hist(resid(m))
```

### 1.a. 

What is the treatment structure? 

### 1.b. 

What is the design structure? 

### 1.c. 

Write a statistical model that could be fitted to these data. 

### 1.d.

Fit the statistical model in (1c) to the data. 

### 1.e. 

Considering that lower logCFU values are better, what is/are the best treatment(s) overall? 











```{r}
d4 <- readxl::read_xlsx("../../../../../consulting/aysu/biofilms/data/Sessile Listeria UV OREI data for stats.xlsx")

d4 <- d4 %>% 
  mutate(Time = as.factor(ifelse(is.na(`Application time (minutes)`), 0,
                       `Application time (minutes)`)),
         .before = `Application time (minutes)`)

m <- lmer(y ~  Treatment * Material * Time + (1|Treatment:Time:Material:`Biological Rep`),
          data = d4)
DHARMa::simulateResiduals(m, plot =T)

d4$p <- predict(m)
d4$r <- resid(m)

d4 %>% 
  filter(!str_detect(Treatment, "SDC") & Treatment != "UV- light only") %>% 
  ggplot(aes(p, r))+
  geom_point(aes(color = Treatment))


d4$y <- simulate(m)$sim_1


unique(d4$Treatment)
DHARMa::simulateResiduals(m, plot = T)

d4 %>% 
  mutate(Treatment =as.numeric(as.factor(Treatment)), 
         Material =LETTERS[as.numeric(as.factor(Material))]) %>% 
  mutate(Time = ifelse(Time ==0, .5, `Application time (minutes)`)) %>%
  dplyr::select(-c(`Application time (minutes)`)) %>% 
  dplyr::select(Treatment, Time, Material, `Biological Rep`, `Technical Rep`, 
                logCFU = y) %>% 
  write.csv("../data/sanitizers.csv")
```






