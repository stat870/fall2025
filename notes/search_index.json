[["index.html", "STAT 870 - Analysis of Messy Data Day 1 Welcome to STAT 870! 1.1 About this course: 1.2 Learning goals 1.3 Overview of the course 1.4 What is messy data anyways? 1.5 Linear Models review 1.6 On notation 1.7 Homework &amp; Announcements", " STAT 870 - Analysis of Messy Data Josefina Lacasa Fall 2025 Day 1 Welcome to STAT 870! August 25th, 2025 1.1 About this course: About me About you: Figure 1.1: Students of this class In rounds: What’s your major and what do you expect to learn in 870? 1.1.1 Logistics Website Syllabus Statistical programming requirements Rough mindmap of the course (on whiteboard) Semester project Grades: A (100-89.999999999(!!!)), B (89.99-79.99), C (79.99-69.99), D (69.99-59.99), F (&lt;59.99). Attendance policies &amp; kahoots 1.2 Learning goals By the end of this course, you should be able to: Identify the treatment design, experiment design, experimental unit and observational unit of simple and complex designed experiments. Distinguish the benefits/disadvantages of different experiment designs. Write the statistical model that corresponds to data generated by designed experiments. Write the Materials and Methods section in a paper (or thesis) that describes the designed experiment. 1.3 Overview of the course Figure 1.2: Mindmap 1.4 What is messy data anyways? Complex dependence structures Complex structure in covariates 1.5 Linear Models review Perhaps the most common model of all time (default in most software) is \\[y_{i} = \\mu_i + \\varepsilon_i, \\ \\varepsilon_i \\sim N(0, \\sigma^2),\\] where: \\(y_{i}\\) is the observed value for the \\(i\\)th observation, \\(\\mu_i\\) is the expected value for the \\(i\\)th observation, \\(\\varepsilon_i\\) is the residual (i.e., the difference between observed and expected). All residuals are iid normal. This example uses the model equation form. The model above can also be written usign the probability distribution form. The probability distribution form is much more flexible because it is compatible with other distributions beyond the normal. It goes like this: \\[y_{i} \\sim N(\\mu_i, \\sigma^2),\\] where the elements are the same as described above. Likewise, we can use the vectorized notation of the probability distribution form, and say that \\[\\mathbf{y} \\sim N(\\boldsymbol\\mu, \\sigma^2 \\mathbf{I}),\\] where: \\(\\mathbf{y} \\equiv [y_1, y_2, ..., y_n]&#39;\\) is the vector of observed values, \\(\\boldsymbol\\mu \\equiv [\\mu_1, \\mu_2, ..., \\mu_n]&#39;\\) is the vector of expected values, \\(\\sigma^2 \\mathbf{I}\\) is the variance-covariance matrix. Note that, more generally, we can call the variance-covariance matrix \\(\\boldsymbol{\\Sigma}\\) or \\(\\mathbf{V}\\). Note that \\[\\sigma^2 \\mathbf{I} = \\sigma^2 \\begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; \\dots &amp; 0 \\\\ 0 &amp; 1 &amp; 0 &amp; \\dots &amp; 0 \\\\ 0 &amp; 0 &amp; 1 &amp; \\dots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\vdots &amp; \\ddots &amp; \\vdots \\\\ 0 &amp; 0 &amp; 0 &amp; \\dots &amp; 1 \\end{bmatrix} = \\begin{bmatrix} \\sigma^2 &amp; 0 &amp; 0 &amp; \\dots &amp; 0 \\\\ 0 &amp; \\sigma^2 &amp; 0 &amp; \\dots &amp; 0 \\\\ 0 &amp; 0 &amp; \\sigma^2 &amp; \\dots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\vdots &amp; \\ddots &amp; \\vdots \\\\ 0 &amp; 0 &amp; 0 &amp; \\dots &amp; \\sigma^2 \\end{bmatrix}.\\] The assumptions behind this model are: Normal distribution of the data Constant variance Independence Linearity In this course, we will mostly deal with cases where: The assumption of independence does not hold (basic and complex designed experiments), The assumption of normality does not make sense (e.g., data are counts, proportions, or stricly positive), The assumption of constant variance does not hold/make sense (e.g., larger biomass is associated to larger variance of said biomass). We will approach most problems with a 3-step approach (Chapter 2 in Stroup et al.): What is the distribution of the data? What is the link function? What is the blueprint of the design/data? Figure 1.3: Common variable distributions. Page 60 in Stroup et al. (2024) 1.6 On notation scalars: \\(y\\), \\(\\sigma\\), \\(\\beta_0\\) vectors: \\(\\mathbf{y} \\equiv [y_1, y_2, ..., y_n]&#39;\\), \\(\\boldsymbol{\\beta} \\equiv [\\beta_1, \\beta_2, ..., \\beta_p]&#39;\\), \\(\\boldsymbol{u}\\) matrices: \\(\\mathbf{X}\\), \\(\\Sigma\\) probability distribution: \\(y \\sim N(0, \\sigma^2)\\), \\(\\mathbf{y} \\sim N(\\boldsymbol{0}, \\sigma^2\\mathbf{I})\\). 1.7 Homework &amp; Announcements Install R and RStudio. Submit Assignment 1 by next Monday. Read Chapter 2 in Stroup et al. (2024) Applied Linear Mixed Models Workshop - Sept 13 &amp; 14 "],["designed-experiments-review.html", "Day 2 Designed Experiments Review 2.1 Announcements 2.2 Designed experiments 2.3 Homework &amp; Announcements", " Day 2 Designed Experiments Review August 27th 2.1 Announcements Assignment 1 is due next Wednesday. Applied Linear Mixed Models Workshop 09/13-09/14. Workshop is full. Email me if you still want to join. 2.2 Designed experiments The golden rules of designed experiments: Replication Randomization Local control Figure 2.1: Principles for conducting valid and efficient experiments. From Box, Hunter and Hunter (2005). About George Box I - A Conversation with George Box [link] About George Box II - An Accidental Statistician: The Life and Memories of George E. P. Box [link] 2.2.1 Treatment structure Solely about the treatment. Most likely connected to the research question and thus defined by the subject matter expert. Figure 2.2: Schematic representation of a one-way treatment structure. A one-way treatment structure means that the expected value of the observations, \\(y\\), is affected by one treatment factor with \\(k\\) levels: \\[g(\\mu_{ij}) = \\eta_{ij} = \\eta_{0} + T_i,\\] where: \\(\\mu_{ij}\\) is the expected value of \\(y_{ij}\\), the observation of the \\(i\\)th treatment and \\(j\\)th repetition, \\(g(\\cdot)\\) is the link function, that ensures that the mean is within the support of the chosen distribution, \\(\\eta_{ij}\\) is the linear predictor of \\(g(\\mu_{ij})\\), \\(\\eta_{0}\\) is the overall mean, and \\(T_i\\) is the effect of the \\(i\\)th level of the treatment \\(T\\). Figure 2.3: Schematic representation of a two-way factorial treatment structure. A two-way treatment structure is similar to a one-way treatment structure, only now the expected value is affected by two treatment factors: \\[g(\\mu_{ijk}) = \\eta_{ijk} = \\eta_{0} + T_i + G_j + (TG)_{ij} ,\\] where: \\(\\mu_{ijk}\\) is the expected value of \\(y_{ij}\\), the observation of the \\(i\\)th treatment \\(T\\), \\(j\\)th treatment \\(G\\), and \\(k\\) repetition, \\(g(\\cdot)\\) is the link function, that ensures that the mean is within the support of the chosen distribution, \\(\\eta_{ijk}\\) is the linear predictor of \\(g(\\mu_{ijk})\\), \\(\\eta_{0}\\) is the overall mean, \\(T_i\\) is the effect of the \\(i\\)th level of the treatment \\(T\\), \\(G_j\\) is the effect of the \\(j\\)th level of the treatment \\(G\\), and \\((TG)_{ij}\\) is the interaction between the \\(i\\)th level of treatment \\(T\\), and \\(j\\)th level of treatment \\(G\\). Figure 2.4: Schematic representation of a tree-way factorial treatment structure. 2.2.2 Design structure The experiment design describes the data generating process (“blueprint” of the data). You’ll notice that the models above only consider the treatment sources of variability to explain variations in the observed values. How were the treatments above (logistically) applied? Useful questions: What is the experimental unit? What is the blueprint of the design? (which observations are similar to what) 2.3 Homework &amp; Announcements Submit Assignment 1 by next Wednesday. Applied Linear Mixed Models Workshop is full. Email me if you still want to join. "],["designed-experiments-review-1.html", "Day 3 Designed Experiments Review 3.1 Announcements 3.2 Semester project 3.3 Designed experiments 3.4 Applied example: fungicide effects on barley genotypes 3.5 Homework &amp; Announcements", " Day 3 Designed Experiments Review September 3rd 3.1 Announcements Assignment 1 is due today! Assignment 2 is posted and due next week. Applied Linear Mixed Models Workshop 09/13-09/14. Workshop is full. Email me if you still want to join. Read Chapter 2 of Stroup’s GLMM book (this chapter only, 1ed&gt;2ed). 3.2 Semester project Proposal due September 24th – see example 1 | see example 2 Must contain: Background, Objectives. Data for the project must be ready to go. Final product: Manuscript + Tutorial. Working in teams vs. solo. Start as soon as possible! 3.3 Designed experiments Let’s review the basics of designed experiments: Research question Planning the experiment Treatment structure - directly dependent on the research question Design structure - mostly depending on logistics. May depend on the research question. 3.3.1 Design structures While the treatment structure defines what effects we will try and estimate as precisely as possible, the design structure tells us the story of how those treatments were applied. Some of the most common designed experiments include completely randomized design (CRD), randomized complete block design (RCBD), split-plot design, relevant variations to the designs above: generalized randomized complete block design, strip-plot design, repeated measures designs. Figure 3.1: Schematic description of an experiment with a completely randomized design Figure 3.2: Schematic description of an experiment with a randomized complete block design Figure 3.3: Schematic description of a field experiment with a split-plot design 3.4 Applied example: fungicide effects on barley genotypes Let’s consider an experiment that aimed to study the effect of fungicide and barley genotypes on grain yield. The study includes two levels of fungicide, and 70 different genotypes, considering all their possible combinations. What is the treatment structure of the experiment? Do we know the design structure of the experiment? Now, the actual experiment was run like this: library(tidyverse) library(agridat) library(lme4) library(emmeans) df_fungicide &lt;- agridat::durban.splitplot df_fungicide %&gt;% ggplot(aes(bed, row))+ coord_fixed()+ geom_tile(aes(fill = fung))+ geom_tile(aes(), color = &quot;black&quot;, fill = NA) What is the treatment structure? What are the experimental units? How many independent observations per treatment factor? What is the design structure? Download R code 3.5 Homework &amp; Announcements Assignment 1 due today. Applied Linear Mixed Models Workshop is full. Email me if you still want to join. "],["linear-mixed-models.html", "Day 4 Linear mixed models 4.1 Announcements 4.2 Statistical models 4.3 The general linear model 4.4 Linear mixed models applied to designed experiments 4.5 Homework", " Day 4 Linear mixed models September 8th 4.1 Announcements Assignment 1 grades are posted. Remember that you have one chance to resubmit for full points. Assignment 2 is due on Wednesday. Last chance to join the mixed models workshop this weekend. Semester project: Proposal due September 24th – see example 1 | see example 2 Must contain: Background, Objectives. Data for the project must be ready to go. Final product: Manuscript + Tutorial. Working in teams vs. solo. Start as soon as possible! This week Today: intro to mixed models + blocks modeling discussion Wednesday: mixed models applied to the fungicide experiment + Kahoot 4.2 Statistical models Statistical models can be typically defined as the combination of a deterministic component (e.g., the linear predictor), and a random component (e.g., the distribution of the data). Learn more about this way of describing statistical models in Stroup et al. (2024) page 4 (and all of Chapter 1 in general). 4.3 The general linear model The general linear model is one of the most commonly used statistical models. We call it “general” because it assumes that the data arise from a normal distribution. [Note: Do not mix up “general” (normal distribution) with “generalized” (multiple possible distributions).] We call it “linear” because the parameters enter the model linearly. For example, the predictor \\(\\beta_0 +\\beta_1 x + \\beta_2 x^2\\) corresponds to a linear model, because the parameters enter linearly. The predictor \\(\\alpha \\exp(\\beta x)\\) corresponds to a nonlinear model, because the parameters enter as the power of the data. The general linear model can be written as \\[\\mathbf{y} = \\mathbf{X}\\boldsymbol{\\beta} + \\boldsymbol\\varepsilon, \\\\ \\boldsymbol{\\varepsilon}\\sim N(\\boldsymbol{0}, \\mathbf{\\Sigma}),\\] where \\(\\mathbf{y}\\) is the vector of the data, \\(\\mathbf{X}\\) is the matrix containing the data, \\(\\boldsymbol{\\beta}\\) is a vector containing all parameters, \\(\\boldsymbol\\varepsilon\\) is a vector containing the residuals (i.e., the difference between observed and predicted). Note that \\(\\boldsymbol\\varepsilon\\) arises from a multivariate normal distribution, with mean zero and a variance-covariance matrix \\(\\mathbf{\\Sigma} = \\sigma^2 \\mathbf{I}\\). Recall some cool properties: The least squares estimate of \\(\\beta\\), \\(\\hat{\\boldsymbol{\\beta}} = (\\mathbf{X}^T\\mathbf{X})^{-1}\\mathbf{X}^T\\mathbf{y}\\), is also the the MLE, is unbiased. \\(\\hat\\sigma^2 = \\frac{SSE}{df_e}\\), not the MLE, is the unbiased estimate of \\(\\sigma^2\\). \\(CI(\\hat\\mu_{ij}) = \\hat\\mu_{ij} \\pm t_{df, \\frac{\\alpha}{2}} \\cdot se(\\hat{\\mu}_{ij})\\), where \\(\\sigma^2_e\\) is the residual variance, and \\(r\\) is the number of repetitions. Under a CRD, \\(se(\\mu_{ij}) = \\sqrt{\\frac{\\sigma^2_e}{r}}\\), where \\(\\sigma^2_e\\) is the residual variance, and \\(r\\) is the number of repetitions. ANOVA tables help us distinguish the most important sources of variability in the data. See Gelman (2005) Essentially, an analysis of variance (ANOVA) divides the predictors into bins and analyzes whether each bin is relevant to explain variability in the data. Typically, ANOVA tables show the sources of variation, their degrees of freedom, an F statistic and, sometimes, a p-value. Sources of variation may come from treatment factors, or elements of the design. Degrees of freedom tells us how many independent variables there are. The F statistic serves as a multivariate t statistic, since it is used to test multiple predictors. 4.3.1 Applied example Swine nutritionists are studying the effect of dietary treatments on the % of fecal dry matter, and whether said effects change at different points in time. In this experiment, 450 pigs were allocated in pens of 5 pigs. Each pen is independently assigned with dietary treatment. There are 6 dietary treatments: negative C, positive C, and 4 different pre-commercial additives. So, there are 45 pens per treatment. One (randomly selected) pig per pen was observed at 3 points in time. What is the experimental unit? What is the observational unit? What is the treatment structure? What is the design structure? A reasonable model could be \\[y_{ijk} \\sim N(\\mu_{ijk}, \\sigma^2),\\] \\[\\mu_{ijk} = \\eta_{ijk},\\] \\[\\eta_{ijk} = \\eta_0 + D_i + T_j + (DT)_{ij},\\] where: \\(y_{ijk}\\) is the observed dry matter (%) for the \\(i\\)th dietary treatment, \\(j\\)th time, and \\(k\\)th repetition, \\(\\mu_{ijk}\\) is the expected value for the \\(i\\)th dietary treatment, \\(j\\)th time, and \\(k\\)th repetition, \\(\\sigma^2\\) is the residual variance, \\(\\eta_{ijk}\\), the linear predictor is equivalent to the expected value because the link function is the identity function, \\(\\eta_0\\) is the overall mean of the linear predictor, \\(F_i\\) is the effect of the \\(i\\)th dietary treatment, \\(G_j\\) is the effect of the \\(j\\)th time, \\((FG)_{ij}\\) is the interaction for the \\(i\\)th dietary treatment and \\(j\\)th time A reasonable ANOVA shell could be: Table 4.1: ANOVA table for a CRD with a two-way factorial treatment structure. Source df Diet d-1 Time t-1 D x T (d-1)(t-1) Error N-(d*t) Total N-1 Table 4.1: ANOVA table for the diet CRD. Source df Diet 5 Time 2 D x T 10 Error 252 Total 269 Let’s implement that model: # load the data pigs_crd &lt;- read.csv(&quot;../../data_confid/fecalm_swine_crd.csv&quot;) pigs_crd$Day &lt;- as.factor(pigs_crd$Day) # fit the model m &lt;- lm(F.Dry.matter ~ Day*Trt, data = pigs_crd) Model checks plot(predict(m), abs(resid(m))) car::qqPlot(m) ## [1] 109 148 # anova car::Anova(m, type = 2, test.statistic = &quot;F&quot;) ## Anova Table (Type II tests) ## ## Response: F.Dry.matter ## Sum Sq Df F value Pr(&gt;F) ## Day 850.7 2 8.6720 0.0002279 *** ## Trt 896.5 5 3.6556 0.0032772 ** ## Day:Trt 673.1 10 1.3723 0.1934086 ## Residuals 12360.9 252 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 We can even get the standard errors and, together with the degrees of freedom, get the 95% confidence intervals. library(emmeans) # get the s.e. by hand n.reps &lt;- 45 sigma2.hat &lt;- sigma(m)^2 # here you have the s.e. (se.mu &lt;- sqrt(sigma2.hat/n.reps)) ## [1] 1.044041 # get the CI # get the mean mu &lt;- as.data.frame(emmeans(m, ~Trt, at = list(Trt = &quot;A&quot;)))[,2] # get the t statistic for the CI t.star &lt;- qt(p = .975, df = m$df.residual) (lower.CI_TrtA &lt;- mu - t.star*se.mu) ## [1] 16.40749 (upper.CI_TrtA &lt;- mu + t.star*se.mu) ## [1] 20.5198 mg_means &lt;- emmeans(m, ~Trt) head(mg_means) ## Trt emmean SE df lower.CL upper.CL ## A 18.5 1.04 252 16.4 20.5 ## B 23.6 1.04 252 21.5 25.6 ## C 20.1 1.04 252 18.1 22.2 ## D 18.3 1.04 252 16.3 20.4 ## E 19.8 1.04 252 17.8 21.9 ## F 18.6 1.04 252 16.5 20.6 ## ## Results are averaged over the levels of: Day ## Confidence level used: 0.95 4.4 Linear mixed models applied to designed experiments When the independence assumption cannot be taken for granted, especially if we know the dependence patterns in the data, we must account for said dependence pattern. Take the previous example, but in a blocked design instead of a CRD. The blocks are basically rooms that hold 90 pens. This means that the observations are not really independent anymore. After all, it’s hard to find rooms that fit 90 pens! Consider an experiment with the same treatments, same number of EUs, but ran in 3 different rooms with 30 pens each. Each room has 5 pens of each dietary treatment. What is the experimental unit? What is the observational unit? What is the treatment structure? What is the design structure? Let’s re-do the statistical model and ANOVA shell: A reasonable model could be \\[y_{ijkl}|b_k \\sim N(\\mu_{ijk}, \\sigma^2),\\] \\[\\mu_{ijkl} = \\eta_{ijkl},\\] \\[\\eta_{ijkl} = \\eta_0 + D_i + T_j + (DT)_{ij} + b_k,\\] where: \\(y_{ijk}\\) is the observed dry matter (%) for the \\(i\\)th dietary treatment, \\(j\\)th time, and \\(k\\)th room and \\(l\\)th repetition, \\(\\mu_{ijk}\\) is the expected value for the \\(i\\)th dietary treatment, \\(j\\)th time, and \\(k\\)th room and \\(l\\)th repetition, \\(\\sigma^2\\) is the residual variance, \\(\\eta_{ijk}\\), the linear predictor is equivalent to the expected value because the link function is the identity function, \\(\\eta_0\\) is the overall mean of the linear predictor, \\(F_i\\) is the effect of the \\(i\\)th dietary treatment, \\(G_j\\) is the effect of the \\(j\\)th time, \\((FG)_{ij}\\) is the interaction for the \\(i\\)th dietary treatment and \\(j\\)th time, \\(b_k\\) is the effect of the \\(k\\)th room, \\(b_k \\sim N(0, \\sigma^2_b)\\). A reasonable ANOVA shell could be: Table 4.2: ANOVA table for a GRCBD with a two-way factorial treatment structure. Source df Room r-1 Diet d-1 Time t-1 D x T (d-1)(t-1) Error N-(d*t)-r Total N-1 Table 4.2: ANOVA table for the diet GRCBD. Source df Room 2 Diet 5 Time 2 D x T 10 Error 250 Total 269 Let’s implement that model: # load the data pigs_grcbd &lt;- read.csv(&quot;../../data_confid/fecalm_swine_grcbd.csv&quot;) pigs_grcbd$Day &lt;- as.factor(pigs_grcbd$Day) pigs_grcbd$Room &lt;- as.factor(pigs_grcbd$Room) # fit the model library(lme4) m_random &lt;- lmer(F.Dry.matter ~ Day*Trt + (1|Room), data = pigs_grcbd) Model checks plot(predict(m_random), abs(resid(m_random))) # anova car::Anova(m_random, type = 2, test.statistic = &quot;F&quot;) ## Analysis of Deviance Table (Type II Wald F tests with Kenward-Roger df) ## ## Response: F.Dry.matter ## F Df Df.res Pr(&gt;F) ## Day 10.7115 2 250 3.441e-05 *** ## Trt 4.7730 5 250 0.0003483 *** ## Day:Trt 1.1153 10 250 0.3509474 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Notice that the 252 degrees of freedom (aka independent observations) from the CRD are now spread across different levels, connected to different variance components, blocks and random error. 4.4.1 General notation for linear mixed models The standard notation for mixed models is \\[\\mathbf{y} = \\mathbf{X}\\boldsymbol{\\beta} + \\mathbf{Z}\\boldsymbol{u} + \\boldsymbol\\varepsilon, \\\\ \\boldsymbol{u}\\sim N(\\boldsymbol{0}, \\mathbf{G}), \\\\ \\boldsymbol{\\varepsilon}\\sim N(\\boldsymbol{0}, \\mathbf{R}),\\] where: \\(\\mathbf{y}\\) is the vector containing the data, \\(\\boldsymbol{\\beta}\\) is the vector containing the model fixed effects (usually treatments), \\(\\mathbf{X}\\) is the matrix containing information about the treatment allocation, \\(\\boldsymbol{u}\\) is the vector containing the model random effects (usually elements of the design). Note that \\(\\boldsymbol{u}\\) arises from a normal distribution with mean 0 and variance-covariance matrix \\(\\mathbf{G})\\). \\(\\mathbf{Z}\\) is the matrix containing information about the design, \\(\\boldsymbol\\varepsilon\\) is the model residual. Note that \\(\\boldsymbol{\\varepsilon}\\) arises from a normal distribution with mean 0 and variance-covariance matrix \\(\\mathbf{R})\\). Note that the conditional distribution of \\(\\mathbf{y}\\) is \\[\\mathbf{y} \\vert \\boldsymbol{u} \\sim N(\\mathbf{X}\\boldsymbol{\\beta} + \\mathbf{Z}\\boldsymbol{u},\\mathbf{R}).\\] The marginal distribution of \\(\\mathbf{y}\\) is \\[\\mathbf{y} \\sim N(\\mathbf{X}\\boldsymbol{\\beta}, \\mathbf{Z}\\mathbf{G}\\mathbf{Z}&#39; + \\mathbf{R}).\\] So, essentially what happened before was that the treatment effects haven’t changed, their effect sizes and means haven’t changed, but the variance-covariance matrix did change. A couple things did change: Shrinkage Estimation of \\(\\sigma^2\\) Estimation of \\(se(\\hat\\mu)\\) Degrees of freedom change 4.4.2 Class discussion: Blocks - random or fixed? Treatment point estimates don’t change whether blocks are fixed or random. m_fixed &lt;- lm(F.Dry.matter ~ Day*Trt + Room, data = pigs_grcbd) mg_means_fixed &lt;- emmeans(m_fixed, ~Trt, contr = list(c(1, -1, 0, 0, 0, 0))) ## NOTE: Results may be misleading due to involvement in interactions mg_means_random &lt;- emmeans(m_random, ~Trt, contr = list(c(1, -1, 0, 0, 0, 0))) ## NOTE: Results may be misleading due to involvement in interactions as.data.frame(mg_means_fixed$emmeans) %&gt;% mutate(blocks = &quot;fixed&quot;) %&gt;% bind_rows(as.data.frame(mg_means_random$emmeans) %&gt;% mutate(blocks = &quot;random&quot;)) %&gt;% ggplot(aes(Trt, emmean))+ geom_errorbar(aes(ymin = emmean-SE, ymax = emmean+SE, color = blocks), position = position_dodge(width = .2), width = 0)+ geom_text(aes(x = 4.5, y = 22.75), label = &quot;s.e.(difference)&quot;)+ geom_errorbar(aes(x = 5.4, y = 22, ymin = 22 , ymax = 22 + SE), width = 0.1, data = as.data.frame(mg_means_random$contrasts))+ geom_errorbar(aes(x = 5.2, y = 22, ymin = 22 , ymax = 22 + SE), width = 0.1, data = as.data.frame(mg_means_fixed$contrasts))+ geom_point(aes(color = blocks), position = position_dodge(width = .2))+ theme_classic()+ labs(color = &quot;Blocks modeled as&quot;, y = &quot;Fecal DM (%)&quot;, x = &quot;Treatment&quot;)+ theme(legend.position = &quot;bottom&quot;) ## Warning in geom_text(aes(x = 4.5, y = 22.75), label = &quot;s.e.(difference)&quot;): All aesthetics have length 1, but the data has 12 rows. ## ℹ Please consider using `annotate()` or provide this layer with data containing ## a single row. More references: Dixon (2016). Gelman (2005) 4.5 Homework Read Chapter 2 in Stroup’s GLMM book (1st ed. superior to 2nd ed.), particularly the “What Would Fisher Do” ANOVA shells. "],["linear-mixed-models-1.html", "Day 5 Linear mixed models 5.1 Announcements 5.2 Linear mixed models 5.3 Next week", " Day 5 Linear mixed models September 10th 5.1 Announcements Assignment 2 is due today! 5.2 Linear mixed models Mixed models come in handy when the (in)famous independence assumption cannot be taken for granted, especially if we know the dependence patterns in the data. We typically know the dependence patterns in the data when running an experiment. For example, the fungicide-barley experiment. Let’s re-do the statistical model and ANOVA shell: A reasonable model could be \\[y_{ijk}|b_k, u_{i(k)} \\sim N(\\mu_{ijk}, \\sigma_e^2),\\] \\[\\mu_{ijk} = \\eta_{ijk},\\] \\[\\eta_{ijk} = \\eta_0 + F_i +G_j + (FG)_{ij}+b_k+ u_{i(k)},\\] where: \\(y_{ijk}\\) is the observed yield for the \\(i\\)th fungicide treatment, \\(j\\)th genotype treatment, and \\(k\\)th repetition, \\(\\mu_{ijk}\\) is the expected value for the \\(i\\)th fungicide treatment, \\(j\\)th genotype treatment, and \\(k\\)th repetition, \\(\\sigma^2\\) is the residual variance, \\(\\eta_{ijk}\\), the linear predictor is equivalent to the expected value because the link function is the identity function, \\(\\eta_0\\) is the overall mean of the linear predictor, \\(F_i\\) is the effect of the \\(i\\)th fungicide treatment, \\(G_j\\) is the effect of the \\(j\\)th genotype treatment, \\((FG)_{ij}\\) is the interaction for the \\(i\\)th fungicide treatment and \\(j\\)th genotype treatment, \\(b_k\\) is the effect of the \\(k\\)th block, \\(b_k \\sim N(0, \\sigma^2_b)\\) \\(u_{i(k)}\\) is the effect of the whole plot corresponding to the \\(i\\)th fungicide treatment in the \\(k\\)th block, \\(u_{i(k)} \\sim N(0, \\sigma^2_u)\\). A reasonable ANOVA shell could be: Table 5.1: This would be the ANOVA under a CRD. Source df - - Fungicide f-1 = 1 - - Genotype g-1 = 69 Fung x Gen (f-1)(g-1) = 69 Error N-fg = 420 Total N-1 Table 5.1: ANOVA table for the fungicide-barley split-plot design. See also Table 24.9 from Milliken and Johnson as a helpful reference. Source df Block b-1 Fungicide f-1 Fungicide(Block) (b-1)(f-1) Genotype g-1 Fung x Gen (f-1)(g-1) Gen(Block x Fung) f(b-1)(g-1) Total N-1 Table 5.1: ANOVA table for the fungicide-barley split-plot design. Source df Block 3 Fungicide 1 Fungicide(Block) 3 Genotype 69 Fung x Gen 69 Gen(Block x Fung) 414 Total 559 Notice that the 420 degrees of freedom (aka independent observations) from the CRD ANOVA are now spread across different levels, connected to different variance components: blocks, whole plots, and random error. This means that there is a different number of independent observations for Fungicide compared to Genotype. The variance components will affect the inference distinctly: Standard errors for comparisons at the whole plot: \\(se(\\mu_{i\\cdot}-\\mu_{i&#39;\\cdot}) = \\sqrt{\\frac{2(\\sigma^2_e + g\\sigma^2_u)}{gb}}\\) Standard errors for comparisons at the split plot: \\(se(\\mu_{\\cdot j}-\\mu_{\\cdot j&#39;}) = \\sqrt{\\frac{2 \\sigma^2_e }{fb}}\\) Let’s apply that model: library(lme4) # load the data url &lt;- &quot;https://raw.githubusercontent.com/stat870/fall2025/refs/heads/main/data/fung_barley_sp.csv&quot; fung_sp &lt;- read.csv(url) fung_sp %&gt;% ggplot(aes(bed, row))+ coord_fixed()+ theme_minimal()+ geom_tile(aes(fill = fung))+ geom_tile(aes(), color = &quot;black&quot;, fill = NA) # fit the model m &lt;- lmer(yield ~ fung*gen + (1|block/fung), data = fung_sp) # anova car::Anova(m, type = 2, test.statistic = &quot;F&quot;) ## Analysis of Deviance Table (Type II Wald F tests with Kenward-Roger df) ## ## Response: yield ## F Df Df.res Pr(&gt;F) ## fung 40.2718 1 3 0.007915 ** ## gen 7.2008 69 414 &lt; 2.2e-16 *** ## fung:gen 0.9331 69 414 0.629010 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 5.2.1 Why do we call these multi-level models? The data are clustered in groups that were generated under similar conditions. What are those groups in the barley example? Figure 5.1: Intuitive visualization of a split-plot design model as a hierarchical (multilevel) model. 5.2.2 Degrees of freedom in a mixed model Degrees of freedom for means are not that easy and straightforward to compute under mixed models anymore. There are approximate methods to calculate the degrees of freedom, like Satterthwaite or Kenward-Roger. mg_means &lt;- emmeans(m, ~fung:gen) head(mg_means) ## fung gen emmean SE df lower.CL upper.CL ## F1 G01 5.24 0.174 31.4 4.88 5.59 ## F2 G01 4.58 0.174 31.4 4.23 4.94 ## F1 G02 5.38 0.174 31.4 5.02 5.73 ## F2 G02 4.75 0.174 31.4 4.39 5.11 ## F1 G03 6.53 0.174 31.4 6.18 6.89 ## F2 G03 5.62 0.174 31.4 5.26 5.97 ## ## Degrees-of-freedom method: kenward-roger ## Confidence level used: 0.95 However, computing the degrees of freedom for the comparisons is much more straightforward (esp. because this a balanced design). Take a look at the ANOVA table, and the experimental units. sigma2_e &lt;- sigma(m)^2 sigma2_wp &lt;- as.data.frame(VarCorr(m))[1,]$vcov sigma2_b &lt;- as.data.frame(VarCorr(m))[2,]$vcov levels_wp &lt;- dplyr::n_distinct(fung_sp$fung) levels_sp &lt;- dplyr::n_distinct(fung_sp$gen) reps &lt;- dplyr::n_distinct(fung_sp$block) Differences between levels of the factor at the whole plot – \\(se(\\mu_{i\\cdot}-\\mu_{i&#39;\\cdot}) = \\sqrt{\\frac{2(\\sigma^2_e + g\\sigma^2_u)}{gb}}\\). # get the s.e. for comparisons between fungicide treatments by hand sqrt( 2*(sigma2_e + levels_sp*sigma2_wp) / (levels_sp*reps)) ## [1] 0.086331 emmeans(m, ~fung, contr = list(c(1, -1)))$contr ## NOTE: Results may be misleading due to involvement in interactions ## contrast estimate SE df t.ratio p.value ## c(1, -1) 0.548 0.0863 3 6.346 0.0079 ## ## Results are averaged over the levels of: gen ## Degrees-of-freedom method: kenward-roger Differences between levels of the factor at the split plot – \\(se(\\mu_{\\cdot j}-\\mu_{\\cdot j&#39;}) = \\sqrt{\\frac{2 \\sigma^2_e }{fb}}\\). # get the s.e. for comparisons between genotype treatments by hand sqrt( 2*(sigma2_e ) / (levels_wp*reps)) ## [1] 0.1405927 emmeans(m, ~gen, contr = list(c(1, -1, rep(0, 68))))$contr ## NOTE: Results may be misleading due to involvement in interactions ## contrast estimate SE ## c(1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.152 0.141 ## df t.ratio p.value ## 414 -1.085 0.2787 ## ## Results are averaged over the levels of: fung ## Degrees-of-freedom method: kenward-roger 5.3 Next week Monday: shrinkage, use of BLUPs versus BLUEs, REML Wednesday: GLMMs "],["semester-project-1.html", "Day 6 Semester Project 6.1 Learning objectives 6.2 Partial deadlines", " Day 6 Semester Project Semester projects may deal with any topic that interests you [the student], as long as it is approved by the instructor. Broadly, projects are expected to (i) identify a research problem, (ii) develop an appropriate workflow that is appropriate for solving that problem, and (iii) create a report and reproducible tutorial. 6.1 Learning objectives Be able to identify an experiment design that is appropriate for answering a given research question and discuss the strengths and weaknesses of that design for answering the question. Be able to write the materials and methods section of a paper/thesis, including the statistical model that corresponds the experiment design. 6.2 Partial deadlines 6.2.1 Project proposal - Due Friday September 24 at 11:59pm CT Write a page-long project proposal that states your research problem and the objective of your project. An example of an appropriate project proposal can be found here. 6.2.2 Written report for peer review - Due Thursday November 27 at 11:59pm CT for peer review 6.2.3 Oral presentation - Somewhere between December 3 - December 12 Prepare a 15 minute presentation of the core aspects of your project. Presentations should include at least: Motivation, Methods, including a clear and complete description of the statistical model and code, Discussion of strengths and weaknesses. 6.2.4 Written report - Due Friday December 19 at 11:59pm CT for peer review Submit a manuscript including: Introduction (background &amp; justification of the problem) Methods, including: A complete ANOVA table describing the degrees of freedom associated to mean comparisons, A clear and complete description of the statistical model, R code to implement that model, Results Discussion including strengths and weaknesses of the design/analysis, Conclusions. "]]
